<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gartic.io Kullanƒ±cƒ± Listesi</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            /* Koyu Tema Varsayƒ±lanlarƒ± */
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --card-bg: #0f3460;
            --text-color: #e0e0e0;
            --accent-color-blue: #007bff;
            --accent-color-red: #e74c3c;
            --border-color: #007bff;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --gradient-start: #1a1a2e;
            --gradient-end: #0f3460;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            background-color: var(--secondary-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 16px var(--shadow-color);
            max-width: 1200px;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 20px;
        }

        h1, h2, h3 {
            color: var(--accent-color-blue);
            text-align: center;
            margin-bottom: 20px;
        }

        .language-selection {
            margin-bottom: 25px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .language-selection h3 {
            color: var(--text-color);
            margin-top: 0;
            margin-bottom: 15px;
        }

        .form-select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            appearance: none; /* Varsayƒ±lan ok simgesini kaldƒ±r */
            -webkit-appearance: none;
            -moz-appearance: none;
            cursor: pointer;
            outline: none;
            box-shadow: 0 4px 8px var(--shadow-color);
        }

        .form-select:focus {
            border-color: var(--accent-color-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
        }

        .form-select {
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23e0e0e0%22%20d%3D%22M287%2069.9a17.6%2017.6%200%200%200-24.9%200L146.2%20185.3%2030.3%2069.9a17.6%2017.6%200%200%200-24.9%2024.9l130.6%20130.6c6.8%206.8%2017.9%206.8%2024.7%200l130.6-130.6c6.8-6.8%206.8-17.9%200-24.9z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px;
        }

        .language-buttons-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .language-button {
            background-color: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.3s, transform 0.2s, border-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .language-button:hover {
            background-color: var(--accent-color-blue);
            transform: translateY(-2px);
        }

        .language-button.active {
            background-color: var(--accent-color-blue);
            border-color: var(--accent-color-blue);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
        }

        .flag {
            font-size: 1.2rem;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
            justify-content: center; /* ORTALAMA */
            align-items: center;
        }

        .controls input[type="text"] {
            flex-grow: 1;
            padding: 8px 12px; /* DAHA DA K√ú√á√úLT√úLD√ú */
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            outline: none;
            max-width: 150px; /* DAHA DA K√ú√á√úLT√úLD√ú */
            height: 30px; /* SABƒ∞T Y√úKSEKLƒ∞K */
            box-sizing: border-box; /* Padding ve border y√ºksekliƒüe dahil */
        }

        .controls input[type="number"] { /* Proxy input i√ßin eklendi */
            flex-grow: 1;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 1rem;
            outline: none;
            max-width: 100px; /* Daha k√º√ß√ºk */
            height: 30px;
            box-sizing: border-box;
            text-align: center;
        }

        .controls input[type="text"]::placeholder {
            color: #ccc;
        }

        .controls button {
            padding: 5px 8px; /* DAHA DA K√ú√á√úLT√úLD√ú */
            border-radius: 8px;
            border: none;
            background-color: var(--accent-color-blue);
            color: white;
            font-size: 0.75rem; /* DAHA DA K√ú√á√úLT√úLD√ú */
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            max-width: 80px; /* DAHA DA K√ú√á√úLT√úLD√ú */
            height: 30px; /* SABƒ∞T Y√úKSEKLƒ∞K */
            box-sizing: border-box; /* Padding ve border y√ºksekliƒüe dahil */
        }

        .controls button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .controls button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        .checkbox-group {
            display: flex; /* YAN YANA Hƒ∞ZALAMA */
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center; /* EK: Ortalamak i√ßin */
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--accent-color-blue);
            cursor: pointer;
        }

        .stats {
            text-align: center;
            margin-bottom: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
        }

        #loadingIndicator {
            display: none;
            text-align: center;
            margin-top: 20px;
            font-size: 1.2rem;
            color: var(--accent-color-blue);
        }

        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); /* K√ú√á√úLT√úLD√ú */
            gap: 15px; /* K√ú√á√úLT√úLD√ú */
            justify-content: center;
        }

        .user {
            background-color: var(--card-bg);
            border-radius: 10px;
            padding: 12px; /* K√ú√á√úLT√úLD√ú */
            box-shadow: 0 4px 8px var(--shadow-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px; /* K√ú√á√úLT√úLD√ú */
            position: relative;
            transition: transform 0.2s;
            text-align: center;
        }

        .user:hover {
            transform: translateY(-5px);
        }

        .user img {
            width: 60px; /* K√ú√á√úLT√úLD√ú */
            height: 60px; /* K√ú√á√úLT√úLD√ú */
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color-blue);
            flex-shrink: 0;
            cursor: pointer;
        }

        .user.nofoto img {
            border: 3px solid var(--accent-color-red);
        }

        .user.discord img {
            border: 3px solid #7289da; /* Discord Blue */
        }

        .user-details {
            flex-grow: 1;
        }

        .user-details b {
            font-size: 0.95rem; /* K√ú√á√úLT√úLD√ú */
            color: var(--accent-color-blue);
            word-break: break-word;
        }

        .user-details i {
            display: block;
            margin-top: 2px; /* K√ú√á√úLT√úLD√ú */
            font-style: normal;
            color: #bbb;
            font-size: 0.85rem; /* K√ú√á√úLT√úLD√ú */
        }

        .room-link {
            display: inline-block;
            margin-top: 2px; /* K√ú√á√úLT√úLD√ú */
            color: var(--text-color);
            text-decoration: none;
            font-size: 0.75rem; /* K√ú√á√úLT√úLD√ú */
            background-color: rgba(0, 123, 255, 0.2);
            padding: 2px 5px; /* K√ú√á√úLT√úLD√ú */
            border-radius: 4px;
            transition: background-color 0.3s;
            word-break: break-all;
        }

        .room-link:hover {
            background-color: var(--accent-color-blue);
        }

        .action-buttons {
            margin-top: 6px; /* K√ú√á√úLT√úLD√ú */
            display: flex;
            flex-wrap: wrap;
            gap: 5px; /* K√ú√á√úLT√úLD√ú */
            justify-content: center;
        }

        .action-buttons button {
            padding: 3px 7px; /* K√ú√á√úLT√úLD√ú */
            border-radius: 4px;
            border: none;
            background-color: #555;
            color: white;
            cursor: pointer;
            font-size: 0.7rem; /* K√ú√á√úLT√úLD√ú */
            transition: background-color 0.3s;
        }

        .action-buttons button:hover {
            background-color: #777;
        }

        .discord-profile-btn {
            background-color: #7289da !important; /* Discord Blue */
        }

        .discord-profile-btn:hover {
            background-color: #677bc4 !important;
        }

        .favorite-btn {
            position: absolute;
            top: 6px; /* K√ú√á√úLT√úLD√ú */
            right: 6px; /* K√ú√á√úLT√úLD√ú */
            background: none !important;
            border: none !important;
            color: #ccc;
            font-size: 1.1rem; /* K√ú√á√úLT√úLD√ú */
            cursor: pointer;
            transition: color 0.2s;
            padding: 2px; /* K√ú√á√úLT√úLD√ú */
        }

        .favorite-btn:hover {
            color: #ffc107 !important;
        }

        .favorite-btn.favorited {
            color: #ffc107;
        }

        /* Profil Modal */
        .profile-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .profile-modal-content {
            background-color: var(--secondary-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);
            text-align: center;
            max-width: 400px;
            width: 90%;
            position: relative;
        }

        .profile-modal-content h2 {
            color: var(--accent-color-blue);
            margin-top: 0;
            margin-bottom: 20px;
        }

        .profile-modal-content img {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid var(--accent-color-blue);
            margin-bottom: 20px;
        }

        .profile-modal-content p {
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .profile-modal-content .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .profile-modal-content .modal-buttons button,
        .profile-modal-content .modal-buttons a {
            padding: 10px 15px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s;
        }

        .profile-modal-content .modal-buttons .close-btn {
            background-color: var(--accent-color-red);
            color: white;
        }

        .profile-modal-content .modal-buttons .close-btn:hover {
            background-color: #c0392b;
        }

        .profile-modal-content .modal-buttons .view-photo-link,
        .profile-modal-content .modal-buttons .discord-profile-btn {
            background-color: var(--accent-color-blue);
            color: white;
        }

        .profile-modal-content .modal-buttons .view-photo-link:hover,
        .profile-modal-content .modal-buttons .discord-profile-btn:hover {
            background-color: #0056b3;
        }

        .profile-modal-content .modal-buttons .discord-profile-btn {
            background-color: #7289da;
        }

        .profile-modal-content .modal-buttons .discord-profile-btn:hover {
            background-color: #677bc4;
        }

        /* Go to Top Button */
        #goToTopBtn {
            display: none; /* Hidden by default */
            position: fixed; /* Fixed/sticky position */
            bottom: 30px; /* Place the button at the bottom of the page */
            right: 30px; /* Place the button 30px from the right */
            z-index: 99; /* Make sure it does not overlap */
            border: none; /* Remove borders */
            outline: none; /* Remove outline */
            background-color: var(--accent-color-blue); /* Set a background color */
            color: white; /* Text color */
            cursor: pointer; /* Add a mouse pointer on hover */
            padding: 15px; /* Some padding */
            border-radius: 10px; /* Rounded corners */
            font-size: 18px; /* Increase font size */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s, transform 0.2s, opacity 0.3s;
            opacity: 0.8;
        }

        #goToTopBtn:hover {
            background-color: #0056b3; /* Darker background on hover */
            transform: translateY(-3px);
            opacity: 1;
        }

        .footer {
            margin-top: 40px;
            font-size: 0.9rem;
            color: #888;
            text-align: center;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .controls {
                flex-direction: column;
            }

            .controls input[type="text"],
            .controls button,
            .controls input[type="number"] { /* Proxy input i√ßin de d√ºzenlendi */
                width: 100%;
                max-width: 150px; /* Mobil g√∂r√ºn√ºmde input max-width'ini koru */
                height: 30px; /* Mobil g√∂r√ºn√ºmde de sabit y√ºkseklik */
            }

            .checkbox-group {
                flex-direction: row; /* Mobil g√∂r√ºn√ºmde de yan yana */
                justify-content: center;
                align-items: center;
            }

            .users-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); /* Mobil i√ßin daha da k√º√ß√ºlt√ºld√º */
                gap: 10px; /* Mobil i√ßin daha az bo≈üluk */
            }

            .user {
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding: 8px; /* Mobil i√ßin daha az padding */
            }

            .user img {
                margin-bottom: 5px;
                width: 50px; /* Mobil i√ßin daha k√º√ß√ºk resim */
                height: 50px; /* Mobil i√ßin daha k√º√ß√ºk resim */
            }

            .user-details {
                text-align: center;
            }

            .action-buttons {
                justify-content: center;
                gap: 4px; /* Mobil i√ßin daha az bo≈üluk */
            }

            .action-buttons button {
                padding: 2px 5px; /* Mobil i√ßin daha az padding */
                font-size: 0.65rem; /* Mobil i√ßin daha k√º√ß√ºk font */
            }

            #goToTopBtn {
                bottom: 20px;
                right: 20px;
                padding: 12px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Gartic.io Canlƒ± Kullanƒ±cƒ± Listesi</h1>

    <div class="language-selection">
        <h3>Dil Se√ßimi</h3>
        <select id="languageSelect" class="form-select">
        </select>
    </div>

    <div class="controls">
        <input type="text" id="searchInput" onkeyup="searchUsers()" placeholder="Kullanƒ±cƒ± adƒ± ara...">
        <input type="number" id="proxyCountInput" min="1" value="1" placeholder="Proxy sayƒ±sƒ±">
        <button onclick="resetFiltersAndLoadUsers()" id="refreshButton"><i class="fas fa-sync-alt"></i> Yenile</button>
        <div class="checkbox-group">
            <label>
                <input type="checkbox" id="havefotoCheckbox" onchange="filterUsers()"> Fotoƒüraflƒ±
            </label>
            <label>
                <input type="checkbox" id="nofotoCheckbox" onchange="filterUsers()"> Fotosuz
            </label>
            <label>
                <input type="checkbox" id="discordCheckbox" onchange="filterUsers()"> Discord
            </label>
        </div>
    </div>

    <div class="stats">
        <span id="playerCount">Listelenen ki≈üi sayƒ±sƒ±: 0</span> | <span id="totalPlayerCount">Toplam bulunan ki≈üi sayƒ±sƒ±: 0</span>
    </div>

    <div id="loadingIndicator">Kullanƒ±cƒ±lar y√ºkleniyor... L√ºtfen bekleyin.</div>

    <div id="usersContainer" class="users-grid">
    </div>
</div>

<div id="profileContainer" class="profile-modal-overlay" style="display: none;">
    <div class="profile-modal-content">
        <h2 id="profileTitle"></h2>
        <img id="profileImage" src="" alt="Profil Fotoƒürafƒ±">
        <p id="profileName"></p>
        <div class="modal-buttons">
            <a id="viewPhotoLink" href="#" target="_blank" rel="noopener noreferrer" class="view-photo-link">
                <i class="fas fa-expand-alt"></i> Fotoƒürafƒ± G√∂r√ºnt√ºle
            </a>
            <button id="discordProfileBtn" class="discord-profile-btn" style="display: none;">
                <i class="fab fa-discord"></i> Discord Profili
            </button>
            <button class="close-btn" onclick="closeProfile()">Kapat</button>
        </div>
    </div>
</div>

<button onclick="goToTop()" id="goToTopBtn" title="Sayfa Ba≈üƒ±na Git"><i class="fas fa-arrow-up"></i></button>

<div class="footer">
    Mark tarafƒ±ndan yapƒ±lmƒ±≈ütƒ±r.
</div>

<script>
    const f = (selector) => document.querySelector(selector);
    const fa = (selector) => document.querySelectorAll(selector);

    let totalPlayerCount = 0;
    let favoriteUsers = JSON.parse(localStorage.getItem('favoriteUsers')) || [];
    let isProcessingRooms = false;
    const ROOM_PROCESS_DELAY_MS = 1700;
    const WS_TIMEOUT_MS = 5000;

    let allUsersData = [];
    let abortController = null; // Mevcut istekleri iptal etmek i√ßin AbortController

    const languageFlags = {
        // Mevcut Temalar
        23: { name: 'Az…ôrbaycanca', flag: 'üá¶üáø' },
        45: { name: 'Bahasa Indonesia', flag: 'üáÆüá©' },
        11: { name: 'ƒåe≈°tina', flag: 'üá®üáø' },
        14: { name: 'Deutsch', flag: 'üá©üá™' },
        2: { name: 'English', flag: 'üá¨üáß' }, // UK's flag for general English, can be üá∫üá∏ for US
        3: { name: 'Espa√±ol', flag: 'üá™üá∏' },
        4: { name: 'Fran√ßais', flag: 'üá´üá∑' },
        6: { name: 'Italiano', flag: 'üáÆüáπ' },
        44: { name: 'Magyar', flag: 'üá≠üá∫' },
        18: { name: 'Nederlands', flag: 'üá≥üá±' },
        10: { name: 'Polski', flag: 'üáµüá±' },
        1: { name: 'Portugu√™s', flag: 'üáµüáπ' },
        58: { name: 'Rom√¢nƒÉ', flag: 'üá∑üá¥' },
        22: { name: 'Slovenƒçina', flag: 'üá∏üá∞' },
        13: { name: 'Ti·∫øng Vi·ªát', flag: 'üáªüá≥' },
        8: { name: 'T√ºrk√ße', flag: 'üáπüá∑' },
        21: { name: '–±—ä–ª–≥–∞—Ä—Å–∫–∏ –µ–∑–∏–∫', flag: 'üáßüá¨' },
        7: { name: '–†—É—Å—Å–∫–∏–π', flag: 'üá∑üá∫' },
        40: { name: '◊¢◊ë◊®◊ô◊™', flag: 'üáÆüá±' }, // Hebrew
        19: { name: 'ÿßŸÑÿπÿ±ÿ®Ÿäÿ©', flag: 'üá∏üá¶' }, // Saudi Arabia for Arabic, can be general üá¶üá™ or other
        34: { name: 'ŸÅÿßÿ±ÿ≥€å', flag: 'üáÆüá∑' }, // Persian
        12: { name: '‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢', flag: 'üáπüá≠' },
        16: { name: '‰∏≠Êñá (ÁÆÄÂåñÂ≠ó)', flag: 'üá®üá≥' },
        9: { name: '‰∏≠Êñá (Ëá∫ÁÅ£)', flag: 'üáπüáº' },
        17: { name: '‰∏≠Êñá (È¶ôÊ∏Ø)', flag: 'üá≠üá∞' },
        15: { name: 'Êó•Êú¨Ë™û', flag: 'üáØüáµ' },
        20: { name: 'ÌïúÍµ≠Ïñ¥', flag: 'üá∞üá∑' },

        // Mevcut Olmayan Temalar (Eƒüer kullanƒ±lƒ±rsa) - Sadece √∂rnekler, t√ºm√ºn√º eklemek zorunda deƒüilsiniz
        26: { name: 'Afrikaans', flag: 'üáøüá¶' },
        55: { name: 'Bahasa Melayu', flag: 'üá≤üáæ' },
        30: { name: 'Catal√†', flag: 'üá™üá∏' },
        31: { name: 'Dansk', flag: 'üá©üá∞' },
        33: { name: 'Eesti', flag: 'üá™üá™' },
        67: { name: 'Esperanto', flag: 'üè≥Ô∏è' },
        36: { name: 'F√∏royskt', flag: 'üá´üá¥' },
        37: { name: 'Gaeilge', flag: 'üáÆüá™' },
        38: { name: 'Galego', flag: 'üá™üá∏' },
        43: { name: 'Hrvatski', flag: 'üá≠üá∑' },
        46: { name: '√çslenska', flag: 'üáÆüá∏' },
        66: { name: 'Kurd√Æ', flag: 'üáÆüá∂' },
        52: { name: 'Latvie≈°u', flag: 'üá±üáª' },
        50: { name: 'L√´tzebuergesch', flag: 'üá±üá∫' },
        68: { name: 'Lietuvi≈≥', flag: 'üá±üáπ' },
        56: { name: 'Malti', flag: 'üá≤üáπ' },
        53: { name: 'M–∞–∫–µ–¥–æ–Ω—Å–∫–∏', flag: 'üá≤üá∞' },
        65: { name: 'Norsk', flag: 'üá≥üá¥' },
        61: { name: 'Shqip', flag: 'üá¶üá±' },
        59: { name: 'Sloven≈°ƒçina', flag: 'üá∏üáÆ' },
        35: { name: 'Suomi', flag: 'üá´üáÆ' },
        24: { name: 'Svenska', flag: 'üá∏üá™' },
        62: { name: 'T√ºrkmen', flag: 'üáπüá≤' },
        64: { name: 'Yor√πb√°', flag: 'üá≥üá¨' },
        32: { name: 'ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨', flag: 'üá¨üá∑' },
        27: { name: '–ë–µ–ª–∞—Ä—É—Å–∫–∞—è', flag: 'üáßüáæ' },
        29: { name: '–ë–æ—Å–∞–Ω—Å–∫–∏', flag: 'üáßüá¶' },
        54: { name: '–ú–æ–Ω–≥–æ–ª –•—ç–ª', flag: 'üá≤üá≥' },
        60: { name: '–°—Ä–ø—Å–∫–∏', flag: 'üá∑üá∏' },
        63: { name: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞', flag: 'üá∫üá¶' },
        49: { name: '“ö–∞–∑–∞“õ T—ñ–ª—ñ', flag: 'üá∞üáø' },
        42: { name: '’Ä’°’µ’•÷Ä’•’∂', flag: 'üá¶üá≤' },
        41: { name: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä', flag: 'üáÆüá≥' },
        28: { name: '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ', flag: 'üáßüá©' },
        39: { name: '‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä', flag: 'üáÆüá≥' },
        51: { name: '‡∫û‡∫≤‡∫™‡∫≤‡∫•‡∫≤‡∫ß', flag: 'üá±üá¶' },
        57: { name: '·Äô·Äº·Äî·Ä∫·Äô·Ä¨·ÄÖ·ÄÄ·Ä¨·Ä∏', flag: 'üá≤üá≤' },
        47: { name: '·É•·Éê·É†·Éó·É£·Éö·Éò', flag: 'üá¨üá™' },
        25: { name: '·ä£·àõ·à≠·äõ', flag: 'üá™üáπ' },
        48: { name: '·ûó·û∂·ûü·û∂·ûÅ·üí·ûò·üÇ·ûö', flag: 'üá∞üá≠' },
    };

    let currentLanguage;

    const proxylist = [{"id":"43","ip":"108.181.21.229"},{"id":"44","ip":"108.181.33.135"},{"id":"45","ip":"108.181.33.117"},{"id":"46","ip":"108.181.33.119"},{"id":"47","ip":"108.181.34.57"},{"id":"48","ip":"108.181.34.71"},{"id":"49","ip":"108.181.30.85"},{"id":"50","ip":"108.181.34.149"},{"id":"51","ip":"108.181.32.49"},{"id":"52","ip":"108.181.32.73"},{"id":"53","id":"108.181.32.55"},{"id":"54","ip":"108.181.32.61"},{"id":"56","ip":"108.181.32.59"},{"id":"63","ip":"108.181.43.67"},{"id":"64","ip":"108.181.34.45"},{"id":"68","ip":"108.181.24.243"},{"id":"69","ip":"108.181.34.177"},{"id":"92","ip":"108.181.34.157"},{"id":"144","ip":"195.3.223.166"},{"id":"145","ip":"195.3.223.164"},{"id":"146","ip":"146.19.24.89"},{"id":"149","ip":"195.3.222.15"},{"id":"150","ip":"185.16.39.161"},{"id":"154","ip":"95.214.53.145"},{"id":"157","ip":"95.214.53.152"},{"id":"161","ip":"108.181.8.179"},{"id":"162","ip":"108.181.9.39"},{"id":"163","ip":"108.181.11.39"},{"id":"164","ip":"108.181.6.89"},{"id":"172","ip":"208.87.240.203"},{"id":"173","ip":"208.87.240.219"},{"id":"174","ip":"208.87.240.251"},{"id":"176","ip":"208.87.241.149"},{"id":"177","ip":"108.181.4.237"},{"id":"175","ip":"108.181.4.237"},{"id":"178","ip":"208.87.241.209"},{"id":"179","ip":"108.181.4.241"},{"id":"181","ip":"208.87.240.35"},{"id":"182","ip":"108.181.5.29"},{"id":"180","ip":"208.87.242.233"},{"id":"183","ip":"208.87.242.233"},{"id":"184","ip":"208.87.240.67"},{"id":"185","ip":"95.214.53.48"},{"id":"186","ip":"195.3.222.40"},{"id":"187","ip":"185.225.191.49"},{"id":"189","ip":"185.225.191.57"},{"id":"198","ip":"108.181.11.173"},{"id":"199","ip":"108.181.11.193"},{"id":"200","ip":"108.181.11.137"},{"id":"201","ip":"108.181.11.171"},{"id":"202","ip":"108.181.11.175"},{"id":"203","ip":"185.16.39.144"},{"id":"204","ip":"185.16.39.213"},{"id":"205","ip":"178.211.139.238"},{"id":"216","ip":"185.246.84.18"},{"id":"219","ip":"185.246.84.66"}];
    
    // YGN Croxyproxy y√∂nlendirme mantƒ±ƒüƒ± (sayfa y√ºklendiƒüinde √ßalƒ±≈üƒ±r)
    if(window.location.href.indexOf("ygnnext")>-1){
        sessionStorage.setItem("ygnnext",window.location.href.split("ygnnext=")[1]);
        // Bu kƒ±sƒ±m normalde bir d√ºƒüme tƒ±klamasƒ±nƒ± sim√ºle eder.
        // Bizim senaryomuzda doƒürudan i≈ülem yapacaƒüƒ± i√ßin burayƒ± uygun ≈üekilde ayarlamamƒ±z gerekebilir.
        // ≈ûimdilik burayƒ± pas ge√ßip, alttaki "servers" mantƒ±ƒüƒ±na odaklanalƒ±m.
        // document.getElementsByClassName('fa fa-arrow-right')[0].dispatchEvent(new MouseEvent("click",{bubbles:true,button:0}))
    } 
    if(window.location.href.indexOf("servers")!=-1){
        let inter = setInterval(()=>{
            if(document.querySelector("input[name=proxyServerId]")){
                document.body.innerHTML+=`<form class="myform" method="POST" action="/requests?fso="><input type="hidden" name="url" value="gartic.io"><input type="hidden" name="proxyServerId" value="`+sessionStorage.getItem("ygnnext")+`"><input type="hidden" name="csrf" value="`+document.querySelector("input[name=csrf]").value+`"><input type="hidden" name="demo" value="0"><input type="hidden" name="frontOrigin" value="https://www.croxyproxy.com"></form>`;
                document.querySelector(".myform").submit();
                clearInterval(inter)
            }
        }, 100); // K√º√ß√ºk bir gecikmeyle kontrol et
    } 
    if(window.location.href.indexOf("ygnIPselector")>-1){
        document.body.innerHTML=`<div style="width:100%;height:100vh;"><div style="width:100%;color:black;"><h4>YGN Croxyproxy IP Selector <b>Available proxies: `+proxylist.length+`</b></h4></div><div class="proxies" style="background:blue;color:black;width:100%;display:flex;justify-content:center;align-items:center;flex-wrap:wrap;"></div></div>`;
        proxylist.forEach((item)=>{
            document.querySelector(".proxies").innerHTML+=`<a target="_blank" class="proksi" style="border-radius:3px;margin:5px;padding:5px;background:black;color:tomato;" href="https://www.croxyproxy.com/?ygnnext=`+item.id+`">`+item.ip+`</a>`
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadDefaultLanguage();
        populateLanguageSelect();
        // Proxy se√ßici sayfasƒ±nda deƒüilsek listeleme i≈ülemini ba≈ülat
        if (window.location.href.indexOf("ygnIPselector") == -1) {
            listusers(currentLanguage);
        }

        f('#languageSelect').addEventListener('change', (event) => {
            const selectedLang = parseInt(event.target.value);
            selectLanguage(selectedLang);
        });

        // Go to Top Button g√∂r√ºn√ºrl√ºƒü√ºn√º kontrol et
        window.onscroll = function() { scrollFunction() };
    });

    function loadDefaultLanguage() {
        const savedLanguage = localStorage.getItem('defaultLanguage');
        currentLanguage = savedLanguage ? parseInt(savedLanguage) : 8; // Varsayƒ±lan: T√ºrk√ße (8)
    }

    function populateLanguageSelect() {
        const languageSelect = f('#languageSelect');
        languageSelect.innerHTML = '';

        const sortedLanguageKeys = Object.keys(languageFlags).sort((a, b) => {
            return languageFlags[a].name.localeCompare(languageFlags[b].name, 'tr', { sensitivity: 'base' });
        });

        sortedLanguageKeys.forEach(langValueStr => {
            const langValue = parseInt(langValueStr);
            const langInfo = languageFlags[langValue];
            if (langInfo) {
                const option = document.createElement('option');
                option.value = langValue;
                option.textContent = `${langInfo.flag} ${langInfo.name}`;
                languageSelect.appendChild(option);
            }
        });

        languageSelect.value = currentLanguage;
    }

    function selectLanguage(lang) {
        if (lang !== currentLanguage) {
            if (abortController) {
                abortController.abort();
                console.log("√ñnceki dil listeleme i≈ülemi iptal edildi.");
            }
            isProcessingRooms = false;

            currentLanguage = lang;
            localStorage.setItem('defaultLanguage', currentLanguage.toString());

            setTimeout(() => {
                resetFiltersAndLoadUsers();
            }, 1200);
        }
    }

    function updatePlayerCount(count) {
        const playerCountElement = f("#playerCount");
        playerCountElement.textContent = `Listelenen ki≈üi sayƒ±sƒ±: ${count}`;
    }

    function updateTotalPlayerCount(count) {
        const totalPlayerCountElement = f("#totalPlayerCount");
        totalPlayerCountElement.textContent = `Toplam bulunan ki≈üi sayƒ±sƒ±: ${count}`;
    }

    function extractDiscordID(avatarURL) {
        const matches = avatarURL.match(/\/avatars\/(\d+)\//);
        return matches ? matches[1] : null;
    }

    function renderUsers(usersToRender) {
        const usersContainer = f("#usersContainer");
        usersContainer.innerHTML = "";

        let visibleCount = 0;
        usersToRender.forEach(user => {
            const foto = user.foto || `https://gartic.io/static/images/avatar/svg/${user.avatar}.svg`;
            const uclass = user.foto ? "havefoto" : "nofoto";
            const isDiscordUser = foto.includes("cdn.discordapp.com");
            const discordClass = isDiscordUser ? "discord" : "";
            const discordID = isDiscordUser ? extractDiscordID(foto) : null;

            const discordProfileButtonHTML = discordID
                ? `<button class="discord-profile-btn" onclick="openDiscordProfile('${discordID}')">Discord Profili</button>`
                : '';

            const isFavorited = favoriteUsers.includes(user.id);

            const favoriteButtonHTML = user.foto ? `
                <button class="favorite-btn ${isFavorited ? 'favorited' : ''}" onclick="toggleFavorite(${user.id})">
                    <i class="${isFavorited ? 'fas' : 'far'} fa-star"></i>
                </button>
            ` : '';

            const userHTML = `
                <div class="user ${uclass} ${discordClass}" id="user-${user.id}" data-user-id="${user.id}">
                    ${favoriteButtonHTML}
                    <img src="${foto}" alt="${user.nick}'ƒ±n fotoƒürafƒ±" onclick="openProfile('${user.nick}', '${foto}')">
                    <div class="user-details">
                        <b>${user.nick}</b><br>
                        <i>${user.pontos} pt</i><br>
                        <a href="https://gartic.io/${user.roomlink}" target="_blank" rel="noopener noreferrer" class="room-link">${user.roomlink}</a>
                        <a href="https://gartic.io/${user.roomlink}/viewer" target="_blank" rel="noopener noreferrer" class="room-link">${user.roomlink} izle</a><br>
                        <div class="action-buttons">
                            <button class="view-photo-btn" onclick="viewPhoto('${foto}')">Fotoƒürafƒ± G√∂r√ºnt√ºle</button>
                            ${discordProfileButtonHTML}
                        </div>
                    </div>
                </div>
            `;
            usersContainer.innerHTML += userHTML;
            visibleCount++;
        });
        updatePlayerCount(visibleCount);
    }

    function addPlayers(users, roomlink) {
        users.forEach(user => {
            if (!allUsersData.some(existingUser => existingUser.id === user.id)) {
                allUsersData.push({ ...user, roomlink: roomlink });
            }
        });
        sortAndRenderUsers();
        updateTotalPlayerCount(allUsersData.length);
    }

    function sortAndRenderUsers() {
        let nonFavoritedUsers = allUsersData.filter(user => !favoriteUsers.includes(user.id));
        let favoritedUsers = allUsersData.filter(user => favoriteUsers.includes(user.id));

        favoritedUsers.sort((a, b) => favoriteUsers.indexOf(a.id) - favoriteUsers.indexOf(b.id));

        const sortedUsers = [...favoritedUsers, ...nonFavoritedUsers];

        renderUsers(sortedUsers);
        filterUsers();
    }

    function viewPhoto(photoURL) {
        window.open(photoURL, '_blank', 'noopener,noreferrer');
    }

    function openDiscordProfile(discordID) {
        if (discordID) {
            window.open(`https://discordlookup.com/user/${discordID}`, '_blank', 'noopener,noreferrer');
        } else {
            console.warn("Discord ID bulunamadƒ±.");
        }
    }

    function openProfile(nick, foto) {
        const profileContainer = f("#profileContainer");
        const profileTitle = f("#profileTitle");
        const profileImage = f("#profileImage");
        const profileName = f("#profileName");
        const viewPhotoLink = f("#viewPhotoLink");
        const discordProfileBtn = f("#discordProfileBtn");

        profileTitle.textContent = `Profil: ${nick}`;
        profileImage.src = foto;
        profileImage.alt = `${nick}'ƒ±n Profil Fotoƒürafƒ±`;
        profileName.textContent = `Kullanƒ±cƒ± Adƒ±: ${nick}`;

        viewPhotoLink.href = foto;

        const isDiscordUser = foto.includes("cdn.discordapp.com");
        const discordID = isDiscordUser ? extractDiscordID(foto) : null;
        if (isDiscordUser && discordID) {
            discordProfileBtn.style.display = 'inline-block';
            discordProfileBtn.onclick = () => openDiscordProfile(discordID);
        } else {
            discordProfileBtn.style.display = 'none';
        }

        profileContainer.style.display = 'flex';
    }

    function closeProfile() {
        f("#profileContainer").style.display = 'none';
    }

    function filterUsers() {
        const users = fa(".user");
        const searchInput = f("#searchInput").value.toLowerCase();
        const havefotoCheckbox = f("#havefotoCheckbox");
        const nofotoCheckbox = f("#nofotoCheckbox");
        const discordCheckbox = f("#discordCheckbox");

        havefotoCheckbox.disabled = nofotoCheckbox.checked || discordCheckbox.checked;
        nofotoCheckbox.disabled = havefotoCheckbox.checked || discordCheckbox.checked;
        discordCheckbox.disabled = havefotoCheckbox.checked || nofotoCheckbox.checked;

        let shouldShowAnyFilter = havefotoCheckbox.checked || nofotoCheckbox.checked || discordCheckbox.checked;
        let visibleCount = 0;

        users.forEach(userElement => {
            const userName = userElement.querySelector("b").textContent.toLowerCase();
            const hasPhoto = userElement.classList.contains("havefoto");
            const noPhoto = userElement.classList.contains("nofoto");
            const isDiscord = userElement.classList.contains("discord");

            let passesFilter = false;
            if (!shouldShowAnyFilter) {
                passesFilter = true;
            } else if (havefotoCheckbox.checked && hasPhoto) {
                passesFilter = true;
            } else if (nofotoCheckbox.checked && noPhoto) {
                passesFilter = true;
            } else if (discordCheckbox.checked && isDiscord) {
                passesFilter = true;
            }

            if (userName.includes(searchInput) && passesFilter) {
                userElement.style.display = "flex";
                visibleCount++;
            } else {
                userElement.style.display = "none";
            }
        });

        updatePlayerCount(visibleCount);
    }

    function searchUsers() {
        filterUsers();
    }

    function delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }

    // Proxy se√ßimi i√ßin yardƒ±mcƒ± fonksiyon
    function getRandomProxies(count) {
        const shuffled = [...proxylist].sort(() => 0.5 - Math.random());
        return shuffled.slice(0, Math.min(count, proxylist.length));
    }

    async function listusers(lang) {
        if (isProcessingRooms) {
            console.log("Odalar zaten i≈üleniyor, yeni istek yok. L√ºtfen bekleyin veya yenile butonuna basƒ±n.");
            return;
        }

        abortController = new AbortController();
        const signal = abortController.signal;

        const usersContainer = f("#usersContainer");
        const loadingIndicator = f("#loadingIndicator");
        const refreshButton = f("#refreshButton");
        const proxyCount = parseInt(f("#proxyCountInput").value);

        usersContainer.innerHTML = "";
        allUsersData = [];
        totalPlayerCount = 0;
        updateTotalPlayerCount(0);
        updatePlayerCount(0);
        f("#searchInput").value = "";
        f("#havefotoCheckbox").checked = false;
        f("#nofotoCheckbox").checked = false;
        f("#discordCheckbox").checked = false;
        filterUsers();

        loadingIndicator.style.display = 'block';
        refreshButton.disabled = true;
        isProcessingRooms = true;

        const selectedProxies = getRandomProxies(proxyCount);
        console.log("Se√ßilen Proxyler:", selectedProxies.map(p => p.ip));

        try {
            const response = await fetch(`https://gartic.io/req/list?search=&language[]=${lang}`, { signal });
            if (!response.ok) {
                throw new Error(`Oda listesi √ßekilemedi, HTTP hata kodu: ${response.status}`);
            }
            const rooms = await response.json();

            let proxyIndex = 0;

            for (let i = 0; i < rooms.length; i++) {
                if (signal.aborted) {
                    console.log("ƒ∞≈ülem iptal edildi (yeni dil se√ßimi).");
                    break;
                }

                const room = rooms[i];
                const currentProxy = selectedProxies[proxyIndex % selectedProxies.length]; // Proxyleri sƒ±rayla kullan

                try {
                    const roomResponse = await fetch(`https://gartic.io/serverViewer?v3=1&room=${room.code}`, { signal });
                    if (!roomResponse.ok) {
                        throw new Error(`Oda ${room.code} i√ßin serverViewer verisi √ßekilemedi, HTTP hata kodu: ${roomResponse.status}`);
                    }
                    const roomData = await roomResponse.text();
                    const roomSC = roomData.split("https://")[1].split(".")[0];
                    
                    const originalWsUrl = `wss://${roomSC}.gartic.io/socket.io/?EIO=3&transport=websocket`;
                    const base64EncodedOriginalWsUrl = btoa(originalWsUrl);
                    const croxyproxyWsUrl = `wss://${roomSC}/__cpw.php?u=${base64EncodedOriginalWsUrl}&o=${btoa("https://gartic.io")}`;
                    
                    console.log(`Oda ${room.code} i√ßin kullanƒ±lan proxy: ${currentProxy.ip}`);
                    console.log(`Oda ${room.code} i√ßin Croxyproxy WS URL: ${croxyproxyWsUrl}`);

                    await new Promise((resolve, reject) => {
                        let ws = new WebSocket(croxyproxyWsUrl);
                        let wsResolved = false;

                        const timeout = setTimeout(() => {
                            if (!wsResolved) {
                                ws.close();
                                reject(new Error(`WebSocket baƒülantƒ±sƒ± veya veri alƒ±mƒ± zaman a≈üƒ±mƒ±na uƒüradƒ± (${WS_TIMEOUT_MS}ms) for room ${room.code} with proxy ${currentProxy.ip}.`));
                            }
                        }, WS_TIMEOUT_MS);

                        signal.addEventListener('abort', () => {
                            if (ws.readyState === WebSocket.OPEN) {
                                ws.close();
                                reject(new Error("WebSocket i≈ülemi AbortController tarafƒ±ndan iptal edildi."));
                            }
                        });

                        ws.onopen = () => {
                            ws.send('42[12,{"v":20000,"platform":0,"sala":"' + room.id + '"}]');
                            ws.send('42[46,0]');
                        };

                        ws.onmessage = (msg) => {
                            if (msg.data.indexOf('42["5"') !== -1) {
                                const usersData = JSON.parse('[{"id":' + msg.data.split('[{"id":')[1].split("}]")[0] + "}]");
                                addPlayers(usersData, room.code);
                                clearTimeout(timeout);
                                ws.close();
                                wsResolved = true;
                                resolve();
                            }
                        };

                        ws.onerror = (error) => {
                            if (!wsResolved) {
                                console.error(`[${room.code}] [Proxy: ${currentProxy.ip}] WebSocket hatasƒ±:`, error);
                                clearTimeout(timeout);
                                reject(new Error(`[${room.code}] WebSocket error: ${error.message || 'Bilinmeyen hata'} with proxy ${currentProxy.ip}`));
                            }
                        };

                        ws.onclose = () => {
                            if (!wsResolved) {
                                reject(new Error(`[${room.code}] [Proxy: ${currentProxy.ip}] WebSocket baƒülantƒ±sƒ± beklenmedik ≈üekilde kapandƒ± veya veri alƒ±namadƒ±.`));
                            }
                        };
                    });

                } catch (error) {
                    if (error.name === 'AbortError') {
                        console.log(`Oda ${room.code} i≈ülemi iptal edildi.`);
                        break;
                    }
                    console.warn(`Oda ${room.code} i≈ülenirken hata olu≈ütu veya bo≈ü oda olduƒüu varsayƒ±ldƒ±. Atlanƒ±yor:`, error.message);
                }

                if (signal.aborted) {
                    console.log("ƒ∞≈ülem iptal edildi (yeni dil se√ßimi).");
                    break;
                }
                
                proxyIndex++; 
                await delay(ROOM_PROCESS_DELAY_MS);
            }

        } catch (error) {
            if (error.name === 'AbortError') {
                console.log("Genel i≈ülem AbortController tarafƒ±ndan iptal edildi.");
            } else {
                console.error('Genel i≈ülem sƒ±rasƒ±nda hata olu≈ütu (oda listesi veya d√∂ng√º dƒ±≈üƒ±):', error.message);
            }
        } finally {
            loadingIndicator.style.display = 'none';
            refreshButton.disabled = false;
            isProcessingRooms = false;
            abortController = null;
        }
    }

    function resetFiltersAndLoadUsers() {
        f("#searchInput").value = "";
        f("#havefotoCheckbox").checked = false;
        f("#nofotoCheckbox").checked = false;
        f("#discordCheckbox").checked = false;
        filterUsers();
        listusers(currentLanguage);
    }

    function toggleFavorite(userId) {
        if (favoriteUsers.includes(userId)) {
            favoriteUsers = favoriteUsers.filter(id => id !== userId);
        } else {
            favoriteUsers.push(userId);
        }
        localStorage.setItem('favoriteUsers', JSON.stringify(favoriteUsers));
        sortAndRenderUsers();
    }

    f('#refreshButton').addEventListener('click', () => {
        if (abortController) {
            abortController.abort();
            console.log("Yenile butonu ile √∂nceki i≈ülem iptal edildi.");
        }
        isProcessingRooms = false;
        resetFiltersAndLoadUsers();
    });

    // Go to Top functionality
    function scrollFunction() {
        const goToTopBtn = f("#goToTopBtn");
        if (document.body.scrollTop > 100 || document.documentElement.scrollTop > 100) {
            goToTopBtn.style.display = "block";
        } else {
            goToTopBtn.style.display = "none";
        }
    }

    function goToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
</script>
</body>
</html>
